// VexFlow placeholder - in production use the actual VexFlow library
window.Vex = {
  Flow: {
  Factory: class {
    constructor(options = {}) {
      this.options = options;
      this.canvas = null;
    }
    
    createCanvas(width, height) {
      this.canvas = document.createElement('canvas');
      this.canvas.width = width;
      this.canvas.height = height;
      return this.canvas;
    }
    
    render() {
      console.log('VexFlow rendering (placeholder)');
      return this;
    }
  },
  
  Note: {
    create: (noteData) => ({ ...noteData, rendered: true })
  },
  
  Stave: class {
    constructor(x, y, width) {
      this.x = x;
      this.y = y;
      this.width = width;
    }
    
    addClef(clef) {
      console.log(`Adding clef: ${clef}`);
      return this;
    }
    
    addTimeSignature(timeSig) {
      console.log(`Adding time signature: ${timeSig}`);
      return this;
    }
    
    addKeySignature(keySig) {
      console.log(`Adding key signature: ${keySig}`);
      return this;
    }
    
    setContext(ctx) {
      this.context = ctx;
      return this;
    }
    
    draw() {
      if (this.context) {
        this.context.strokeRect(this.x, this.y, this.width, 50);
        this.context.fillText('Staff Line', this.x + 10, this.y + 25);
      }
      return this;
    }
  },
  
  
  // Add Backends as a static property on Renderer
  Renderer: (function() {
    function Renderer(container, backend) {
      this.container = container;
      this.backend = backend;
      this.width = 800;
      this.height = 200;
      
      this.resize = function(width, height) {
        this.width = width;
        this.height = height;
      };
      
      this.getContext = function() {
        return {
          fillRect: () => {},
          strokeRect: () => {},
          beginPath: () => {},
          closePath: () => {},
          moveTo: () => {},
          lineTo: () => {},
          stroke: () => {},
          fill: () => {},
          save: () => {},
          restore: () => {},
          translate: () => {},
          scale: () => {},
          rotate: () => {}
        };
      };
    }
    
    Renderer.Backends = {
      SVG: 'SVG',
      CANVAS: 'CANVAS'
    };
    
    return Renderer;
  })(),
  
  Stave: function(x, y, width) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.context = null;
    this.clef = null;
    this.timeSignature = null;
    
    this.addClef = function(clef) { 
      this.clef = clef; 
      return this; 
    };
    this.addTimeSignature = function(timeSig) { 
      this.timeSignature = timeSig; 
      return this; 
    };
    this.setContext = function(ctx) { 
      this.context = ctx; 
      return this; 
    };
    this.draw = function() {
      if (!this.context) return;
      
      // Create visual representation of the stave
      const container = this.context.container || document.getElementById('score');
      if (!container) return;
      
      // Create a simple visual representation
      const staveDiv = document.createElement('div');
      staveDiv.style.cssText = `
        position: relative;
        margin: 20px 0;
        padding: 10px;
        border: 2px solid #333;
        background: white;
        border-radius: 5px;
      `;
      
      // Add clef and time signature text
      const header = document.createElement('div');
      header.style.cssText = `
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
      `;
      header.textContent = `${this.clef || 'ð„ž'} ${this.timeSignature || '4/4'}`;
      
      // Add staff lines
      const staffLines = document.createElement('div');
      staffLines.style.cssText = `
        height: 60px;
        background: linear-gradient(to bottom, 
          transparent 0%, transparent 9px,
          #333 9px, #333 10px,
          transparent 10px, transparent 19px,
          #333 19px, #333 20px,
          transparent 20px, transparent 29px,
          #333 29px, #333 30px,
          transparent 30px, transparent 39px,
          #333 39px, #333 40px,
          transparent 40px, transparent 49px,
          #333 49px, #333 50px,
          transparent 50px
        );
        margin: 10px 0;
      `;
      
      staveDiv.appendChild(header);
      staveDiv.appendChild(staffLines);
      
      // Store reference for notes to be added later
      this.notesContainer = staffLines;
      
      container.appendChild(staveDiv);
    };
  },
  
  StaveNote: function(options) {
    this.keys = options.keys;
    this.duration = options.duration;
    this.stave = null;
    
    this.setStave = function(stave) {
      this.stave = stave;
    };
  },
  
  Voice: function(options) {
    this.num_beats = options.num_beats;
    this.beat_value = options.beat_value;
    this.notes = [];
    
    this.addTickables = function(notes) {
      this.notes = notes;
    };
    this.draw = function(context, stave) {
      if (!stave || !stave.notesContainer) return;
      
      // Add notes to the stave
      this.notes.forEach((note, index) => {
        const noteDiv = document.createElement('span');
        noteDiv.style.cssText = `
          display: inline-block;
          margin: 0 5px;
          padding: 2px 6px;
          background: #333;
          color: white;
          border-radius: 3px;
          font-size: 12px;
          font-weight: bold;
        `;
        
        const key = note.keys[0] || 'C/4';
        const duration = note.duration || 'q';
        noteDiv.textContent = `${key} (${duration})`;
        
        stave.notesContainer.appendChild(noteDiv);
      });
    };
  },
  
  Formatter: function() {
    this.joinVoices = function(voices) { 
      return this; 
    };
    this.format = function(voices, width) {
      // Simple formatting - just ensure notes are positioned
    };
  }
  }
};
